# BigQuery Sink Module

Sink module to write the input data to a specified BigQuery table.

## BigQuery sink module parameters

| parameter              | required (default)        | type   | description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| ---------------------- | ------------------------- | ------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| table                  | Required                  | String | Specify the Table to be written in BigQuery. Format: `{project}:{dataset}.{table}`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| schema [1]             | Optional (`auto`)         | String | Specify a schema. By specifying `auto` (default), the schema will be automatically inferred from the data.If you specify `get_from_table`, the schema will be obtained from the table (the table must exist). Alternatively, you can also directly specify the schema in the following format: `"field1:type1,field2:type2,..."`. You can also specify the path where you put the schema.json file which is the output of `bq show --schema --format=prettyjson` format. Error would occur when `schema` is not specified and `table` is not exist in BigQuery yet. |
| create_disposition     | Optional (`CREATE_NEVER`) | Enum   | One of `CREATE_IF_NEEDED` and `CREATE_NEVER`.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| partitioning [2]       | Optional (`disabled`)     | Enum   | Specifies one of `HOUR`, `DAY`, `MONTH` or `YEAR`.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| partitioning_field [2] | Optional (`disabled`)     | String | Specify the field name you want to specify as the partitioning field. This field can only be of type `TIMESTAMP`, `DATE` or `DATETIME`.                                                                                                                                                                                                                                                                                                                                                                                                                             |
| clustering [2]         | Optional (`disabled`)     | String | Specify a split field name for Clustering. [example]: 'field1,field2,field3'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |

[1] `auto`では`sources`モジュールで取得したスキーマを変換して使用するか、Pcollection のネイティブデータ型からスキーマを動的に作成する。`get_from_table`では BigQuery の宛先テーブルのスキーマを取得する。スキーマは上書きされるので、Description や policy tag などを保持したい場合、`get_from_table`を指定する。この場合、BigQuery の宛先テーブルが存在する必要がある。
※ タイムスタンプ型の場合、タイムゾーン情報は無いものとして扱う

[2] 既存の非パーティション分割テーブルをパーティション分割テーブルへ変更することはできないため、これらのオプションは宛先テーブルがパーティション分割テーブル or 存在しない場合にのみ使用する。https://issuetracker.google.com/issues/113304131

## 構成例

- [postgres_to_bigquery](../../../../examples/postgres_to_bigquery.json)
- [postgres_to_bigquery_incremental_append](../../../../examples/postgres_to_bigquery_incremental_append.json)
- [postgres_to_bigquery_incremental_merge](../../../../examples/postgres_to_bigquery_incremental_merge.json)
- [postgres_to_bigquery_multi_pipeline](../../../../examples/postgres_to_bigquery_multi_pipeline.json)
